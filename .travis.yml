
language: java
jdk:
- openjdk8
branches:
  only:
  - develop
  - master

addons:
  sonarcloud:
    organization: "sonarcloud"
    token:
      secure: "ZdfWX0JPk8zwB8wPBnGXopbf5y+r0QQFkbXQtULHuIJp8lFvIcY1i9gDwh5fn7nSv4P1ye+gZVBgA843uHwvT03VQ1T5zt3N33YzrcWN8NknETPAvp/TQsCO/Xt3fFro1yVHPkuBy/B+JqxLxKRkd7m0fQU/CwaHUrVTfblS6OlM+DzJwk21OoZm+ZrW/9tLTpLgCodyUYkayhNLhXghAg6uSDO1nPxX/UrRgfVzT5yoOSnHBhAMJflkpyTbP/FNZPJHWRD6dNo9K4RSu4XzHhxMn7Rk+8V2HrA67PX/W8URZa6JjdatQFCy+89TzqD7r8fS9VUdU71JROaMLb4jwh7cjhjefRi0mMo4EUdyLnuI9tfDY+H4qai5LYE78CiJCIK7v+GMr7HBxhGei7giVmVb9sZIL0JtnWvu0WSyboj7WfDMIPNG3g75T/ZozxmCbJR0xQqlkWYSLQ2lBLbnEjpQGzBs5LNaWI0N9noCGPLUNiF37KPphbCz0kU/6xcBMfhaQCcrf4eYZ9iVotb8L7bq69fncDu9EokfqGQXWiBDEQZQ53EovRAfN/zrXXwDWZ2wFSQPLguE/JPNUUqkzhEuAny3RjpYAK/mH6vfWb3cLjSmcmuUYoBkKP6DBJKintcGciWajBqzEV7QSPjxYZg2C84TAuCgQNLhagA1bGE="

cache:
  directories:
  - ~/.m2/repository

jobs:
  include:
  - stage: build_master
    if: branch = master AND type = push

    before_install:
    - echo "Build Started for Master"
    - export GPG_TTY=$(tty)
    - echo $GPG_SECRET_KEYS | base64 --decode | $GPG_EXECUTABLE --import
    - echo $GPG_OWNERTRUST | base64 --decode | $GPG_EXECUTABLE --import-ownertrust
    - cat /etc/hosts
    - sudo hostname "$(hostname | cut -c1-63)"
    - sed -e "s/^\\(127\\.0\\.0\\.1.*\\)/\\1 $(hostname | cut -c1-63)/" /etc/hosts | sudo
      tee /etc/hosts
    - cat /etc/hosts
    - mvn help:evaluate -N -Dexpression=project.version|grep -v '\[' |  cut -d'-' -f 1  |cut -d'.' -f1-2
    - export project_version=$(mvn help:evaluate -N -Dexpression=project.version|grep -v '\[' | cut -d'-' -f 1 | cut -d'.' -f1-2)
    - git config --local user.name "travis-ci"
    - git config --local user.email "build@travis.ci"
    - export TRAVIS_JOB_NUMBER1=${TRAVIS_JOB_NUMBER:-$(date +'%Y%m%d%H%M%S')-$(git log --format=%h -1)}
    - TRAVIS_JOB_NUMBER1=$(echo $TRAVIS_JOB_NUMBER1 | cut -d'.' -f1)
    - export NEW_VERSION=$project_version.$TRAVIS_JOB_NUMBER1
    - mvn versions:set -DnewVersion=$NEW_VERSION

    install:
    - mvn --settings .maven.xml install -Dgpg.skip  -B -V

    script:
    - mvn clean deploy --settings .maven.xml -DskipTests=true -B -U -Prelease
    - mvn clean org.jacoco:jacoco-maven-plugin:prepare-agent install sonar:sonar -Dsonar.projectKey=MighTguY_customized-symspell

    after_success:
    - bash <(curl -s https://codecov.io/bash)

    before_deploy:
    - git tag $NEW_VERSION

    deploy:
      provider: releases
      api_key:
        secure: vaz/OrLwayipY8axrE0lVexyV0MIowN4wggkAwZPn3t77g3uGB7hD3drPklkptLdIeXRTKpFu8Cduz4n/v5a5JnhhsR3cDmQatGa4/3NzpJNjUEs3NEcFww7KEFMqsuiTh+3cazWT02b9wmwyaJ6tGW2VXI+r8S6qeQVbguEHH4SKoptU6Nf/ONUMIkCGgCnWji9WlnvgMsxUXA2Q9c31MUq5Pi/BVLEWAm+SVMU1AJRDQIXd+qJduo0vEVH7vaHFgS3jO78PyISzZdKaKw9aQGutFuiEp3TzkD9KcmS6J13Akk23ZwCE7U/U3wLnvDBDn26QUYmJPMRZcH+MmXeCL4w9D5s/Rt7ifFcosh0Xg08JSsmgsB0F9Tjpn4oeWip9u2c7bf3fIm4rHf1g0NjPsUJD9OX2aQ9MyR+Woyv8f0o/FSRQd8iAVwX/6BmaSG86R9TzQIz+6K0z+JvAfRXmYotU/XBtr9k0OiDJN+zxEAuSBp78GKtFxyzpulxs6cRf4bOnzKx7pOMHFeLFMbdYkOoebQd4g2u3BT+CLyCjcfxNbyLwYazlt+swd9MawddojA2JTK9NRjosYrZ/OxnggOExH9P+GESM3ivUFhT+g2AavkliWU8zeF8Sx5+emPM+Jxawi8v9rRIeicY7KTHLRaBHpq0C6J1zmQp1bkPAHg=
      file:
      - symspell-lib/target/symspell-lib-$NEW_VERSION.jar
      on:
        repo: MighTguY/customized-symspell
      skip_cleanup: true
      name: $project_version

    after_deploy:
    - mvn versions:set -DnewVersion=$NEW_VERSION-SNAPSHOT
    - sh .travis/push.sh
  - stage: build_develop
    if: branch = develop AND type = push
    before_install:
    - echo "Build Started for Develop"
    - export GPG_TTY=$(tty)
    - echo $GPG_SECRET_KEYS | base64 --decode | $GPG_EXECUTABLE --import
    - echo $GPG_OWNERTRUST | base64 --decode | $GPG_EXECUTABLE --import-ownertrust
    - cat /etc/hosts
    - sudo hostname "$(hostname | cut -c1-63)"
    - sed -e "s/^\\(127\\.0\\.0\\.1.*\\)/\\1 $(hostname | cut -c1-63)/" /etc/hosts | sudo
      tee /etc/hosts
    - cat /etc/hosts
    install:
    - mvn --settings .maven.xml install -Dgpg.skip  -B -V
    script:
    - mvn clean org.jacoco:jacoco-maven-plugin:prepare-agent install sonar:sonar -Dsonar.projectKey=MighTguY_customized-symspell
    - mvn cobertura:cobertura

    after_success:
    - bash <(curl -s https://codecov.io/bash)
  - stage: build_pr
    if: type = pull_request
    before_install:
    - echo "Build Started for PR $TRAVIS_PULL_REQUEST"
    - export GPG_TTY=$(tty)
    - echo $GPG_SECRET_KEYS | base64 --decode | $GPG_EXECUTABLE --import
    - echo $GPG_OWNERTRUST | base64 --decode | $GPG_EXECUTABLE --import-ownertrust
    - cat /etc/hosts
    - sudo hostname "$(hostname | cut -c1-63)"
    - sed -e "s/^\\(127\\.0\\.0\\.1.*\\)/\\1 $(hostname | cut -c1-63)/" /etc/hosts | sudo
      tee /etc/hosts
    - cat /etc/hosts
    install:
    - mvn --settings .maven.xml install -Dgpg.skip  -B -V



